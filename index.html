<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard RIMURU - IoT System</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
</head>
<body>

    <div class="sidebar">
        <div class="logo">
            <h2>RIMURU</h2>
        </div>
        <nav class="sidebar-nav">
            <ul>
                <li><a href="#" class="nav-link active" data-target="dashboard"><i class="fas fa-tachometer-alt"></i> üìä Dashboard</a></li>
                <li><a href="#" class="nav-link" data-target="monitoring"><i class="fas fa-thermometer-half"></i> üå° Gi√°m s√°t</a></li>
                <li><a href="#" class="nav-link" data-target="statistics"><i class="fas fa-chart-line"></i> üìà Bi·ªÉu ƒë·ªì & Th·ªëng k√™</a></li>
                <li><a href="#" class="nav-link" data-target="alerts"><i class="fas fa-bell"></i> üö® C·∫£nh b√°o</a></li>
                <li><a href="#" class="nav-link" data-target="data"><i class="fas fa-database"></i> üóÉ D·ªØ li·ªáu</a></li>
                <li><a href="#" class="nav-link" data-target="settings"><i class="fas fa-cog"></i> ‚öô C√†i ƒë·∫∑t</a></li>
                <li><a href="#" class="nav-link" data-target="help"><i class="fas fa-question-circle"></i> ‚ùì Tr·ª£ gi√∫p</a></li>
            </ul>
        </nav>
    </div>

    <div class="main-content">

        <div id="dashboard" class="tab-content active-tab"> 
            <h1>T·ªïng quan h·ªá th·ªëng</h1>
            
            <div class="stat-cards-row">
                <div class="stat-card temperature">
                    <div class="card-content">
                        <span class="value">-- ¬∞C</span>
                        <span class="label">Nhi·ªát ƒë·ªô hi·ªán t·∫°i</span>
                    </div>
                    <i class="fas fa-thermometer-half card-icon-bg"></i>
                </div>

                <div class="stat-card humidity">
                    <div class="card-content">
                        <span class="value">--%</span>
                        <span class="label">ƒê·ªô ·∫©m hi·ªán t·∫°i</span>
                    </div>
                    <i class="fas fa-water card-icon-bg"></i>
                </div>

                <div class="stat-card gas">
                    <div class="card-content">
                        <span class="value">-- ppm</span>
                        <span class="label">Kh√≠ Gas</span>
                    </div>
                    <i class="fas fa-burn card-icon-bg"></i>
                </div>

                <div class="stat-card dust">
                    <div class="card-content">
                        <span class="value">-- mg/m¬≥</span>
                        <span class="label">B·ª•i PM2.5</span>
                    </div>
                    <i class="fas fa-cloud card-icon-bg"></i>
                </div>

                <div class="stat-card online-devices">
                    <div class="card-content">
                        <span class="value">0 / 3</span>
                        <span class="label">Thi·∫øt b·ªã Online</span>
                    </div>
                    <i class="fas fa-plug card-icon-bg"></i>
                </div>

                <div class="stat-card alerts-status">
                    <div class="card-content">
                        <span class="value">0 C·∫£nh b√°o</span>
                        <span class="label">Ch∆∞a x·ª≠ l√Ω</span>
                    </div>
                    <i class="fas fa-exclamation-triangle card-icon-bg"></i>
                </div>
            </div>
            
            <div class="reports-row">
                <div class="report-box weekly-report">
                    <h3>B√°o c√°o Ho·∫°t ƒë·ªông Tu·∫ßn (Nhi·ªát ƒë·ªô TB)</h3>
                    <div class="chart-area">
                        <canvas id="weekly-chart-canvas"></canvas>
                    </div>
                </div>

                <div class="report-box yearly-report">
                    <h3>T·ªïng quan D·ªØ li·ªáu NƒÉm</h3>
                    <div class="chart-area">
                        <canvas id="yearly-chart-canvas"></canvas>
                    </div>
                    
                    <div class="yearly-summary">
                        <div class="summary-item">
                            <span class="amount" id="sum-total-events">0</span>
                            <span class="caption">T·ªïng s·ªë b·∫£n ghi</span>
                        </div>
                        <div class="summary-item">
                            <span class="amount" id="sum-critical-alerts" style="color: #dc3545;">0</span>
                            <span class="caption">C·∫£nh b√°o ƒë·ªè</span>
                        </div>
                        <div class="summary-item">
                            <span class="amount" id="sum-online-rate">100%</span>
                            <span class="caption">ƒê·ªô ·ªïn ƒë·ªãnh</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="monitoring" class="tab-content">
            <h1>üå° Gi√°m s√°t Th·ªùi gian Th·ª±c</h1>
            <div class="reports-row">
                <div class="report-box" style="flex: 1; min-height: 400px;">
                    <h3>Tr·∫°ng th√°i c√°c Sensor Nodes</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Thi·∫øt b·ªã</th>
                                <th>Nhi·ªát ƒë·ªô (¬∞C)</th>
                                <th>ƒê·ªô ·∫©m (%)</th>
                                <th>Kh√≠ Gas (ppm)</th>
                                <th>B·ª•i (mg/m¬≥)</th>
                                <th>Tr·∫°ng th√°i</th>
                            </tr>
                        </thead>
                        <tbody id="monitoring-table-body">
                            </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="statistics" class="tab-content">
            <h1>üìà Ph√¢n t√≠ch 30 Ng√†y G·∫ßn Nh·∫•t</h1>
            <div class="stats-controls" style="margin-bottom: 20px; display: flex; gap: 15px; align-items: center;">
                <label>Ch·ªçn th√¥ng s·ªë hi·ªÉn th·ªã:</label>
                <select id="stats-metric-select" class="custom-select" onchange="renderAllNodesChart(this.value)">
                    <option value="temp">Nhi·ªát ƒë·ªô (¬∞C)</option>
                    <option value="humid">ƒê·ªô ·∫©m (%)</option>
                    <option value="pm25">B·ª•i PM2.5 (¬µg/m¬≥)</option>
                    <option value="gas">Kh√≠ Gas (ppm)</option>
                </select>
                <button class="btn btn-primary" onclick="load30DayStats()"><i class="fas fa-sync"></i> L√†m m·ªõi d·ªØ li·ªáu</button>
            </div>
        
            <div id="charts-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(450px, 1fr)); gap: 20px;">
                </div>
        </div>

        <div id="alerts" class="tab-content">
            <h1>üö® Qu·∫£n l√Ω C·∫£nh b√°o</h1>
            <div class="reports-row">
                <div class="report-box" style="flex: 1;">
                    <h3>L·ªãch s·ª≠ C·∫£nh b√°o H·ªá th·ªëng</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Th·ªùi gian</th>
                                <th>Thi·∫øt b·ªã</th>
                                <th>Lo·∫°i l·ªói</th>
                                <th>Gi√° tr·ªã</th>
                                <th>Tr·∫°ng th√°i</th>
                                <th>Thao t√°c</th>
                            </tr>
                        </thead>
                        <tbody>
                            </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="data" class="tab-content">
            <h1>üóÉ Qu·∫£n l√Ω D·ªØ li·ªáu</h1>
            <div class="reports-row">
                <div class="report-box" style="flex: 1;">
                    <h3>Truy v·∫•n & Xu·∫•t b·∫£n b√°o c√°o</h3>
                    <div class="query-controls" style="display: flex; gap: 15px; flex-wrap: wrap; margin-bottom: 20px; align-items: flex-end;">
                        <div class="input-item">
                            <label style="display:block;">T·ª´ ng√†y:</label>
                            <input type="date" id="query-start-date" class="custom-input">
                        </div>
                        <div class="input-item">
                            <label style="display:block;">ƒê·∫øn ng√†y:</label>
                            <input type="date" id="query-end-date" class="custom-input">
                        </div>
                        <div class="input-item">
                            <label style="display:block;">Ch·ªçn Node:</label>
                            <select id="query-node-select" class="custom-select">
                                <option value="A101">Node A101</option>
                                <option value="B202">Node B202</option>
                                <option value="C303">Node C303</option>
                                <option value="D404">Node D404</option>
                            </select>
                        </div>
                        <button class="btn btn-primary" onclick="filterData()"><i class="fas fa-search"></i> Truy v·∫•n</button>
                        <button class="btn-excel-custom" onclick="exportToExcel()">
                            <i class="fas fa-file-excel"></i> Xu·∫•t Excel (.xlsx)
                        </button>
                    </div>
                    
                    <div class="table-responsive" style="max-height: 500px; overflow-y: auto; border: 1px solid #ddd; border-radius: 8px;">
                        <table id="query-result-table" class="data-table" style="width: 100%;">
                            <thead>
                                <tr>
                                    <th>Th·ªùi gian</th>
                                    <th>Nhi·ªát ƒë·ªô (¬∞C)</th>
                                    <th>ƒê·ªô ·∫©m (%)</th>
                                    <th>Kh√≠ Gas (ppm)</th>
                                    <th>B·ª•i PM2.5</th>
                                </tr>
                            </thead>
                            <tbody>
                                </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        <div id="settings" class="tab-content">
            <div class="settings-card">
                <h3><i class="fas fa-tools"></i> C·∫•u h√¨nh h·ªá th·ªëng</h3>
                <p>T√πy ch·ªânh c√°c th√¥ng s·ªë hi·ªÉn th·ªã tr√™n Dashboard</p>
                <hr>
                <div style="margin-top: 20px;"></div>
                <div class="setting-group">
                    <label><i class="fas fa-microchip"></i> Ch·ªçn Node theo d√µi ch√≠nh:</label>
                    <select id="node-select" class="custom-select" onchange="updateMainNode(this.value)">
                        <option value="A101">Tr·∫°m A101 (Ph√≤ng kh√°ch)</option>
                        <option value="B202">Tr·∫°m B202 (Ph√≤ng ng·ªß)</option>
                        <option value="C303">Tr·∫°m C303 (S√¢n th∆∞·ª£ng)</option>
                        <option value="D404">Tr·∫°m D404 (Nh√† kho)</option>
                    </select>
                    <small>D·ªØ li·ªáu Realtime v√† Bi·ªÉu ƒë·ªì s·∫Ω l·∫•y t·ª´ tr·∫°m n√†y.</small>
                </div>
        
                <div class="setting-group">
                    <label><i class="fas fa-chart-line"></i> Th√¥ng s·ªë bi·ªÉu ƒë·ªì:</label>
                    <select id="metric-select" class="custom-select" onchange="updateChartMetric(this.value)">
                        <option value="temp">Nhi·ªát ƒë·ªô (¬∞C)</option>
                        <option value="humid">ƒê·ªô ·∫©m (%)</option>
                        <option value="pm25">B·ª•i PM2.5 (¬µg/m¬≥)</option>
                        <option value="gas">Kh√≠ Gas (ppm)</option>
                    </select>
                    <small>Ch·ªçn th√¥ng s·ªë mu·ªën ph√¢n t√≠ch tr√™n bi·ªÉu ƒë·ªì Tu·∫ßn/NƒÉm.</small>
                </div>
            </div>
            <div class="setting-group">
                <label><i class="fas fa-exclamation-triangle"></i> C·∫•u h√¨nh ng∆∞·ª°ng c·∫£nh b√°o:</label>
                <div class="threshold-inputs">
                    <div class="input-item">
                        <span>Nhi·ªát ƒë·ªô (¬∞C):</span>
                        <input type="number" id="threshold-temp" class="custom-input" onchange="updateThreshold('temp', this.value)">
                    </div>
                    <div class="input-item">
                        <span>Kh√≠ Gas (ppm):</span>
                        <input type="number" id="threshold-gas" class="custom-input" onchange="updateThreshold('gas', this.value)">
                    </div>
                    <div class="input-item">
                        <span>B·ª•i PM2.5 (¬µg/m¬≥):</span>
                        <input type="number" id="threshold-pm25" class="custom-input" onchange="updateThreshold('pm25', this.value)">
                    </div>
                </div>
                <small>H·ªá th·ªëng s·∫Ω ghi nh·∫≠n c·∫£nh b√°o n·∫øu gi√° tr·ªã v∆∞·ª£t qu√° c√°c ng∆∞·ª°ng n√†y.</small>
            </div>
            <div class="setting-group">
                <label><i class="fas fa-clock"></i> Ng∆∞·ª°ng th·ªùi gian tr·∫°ng th√°i (ph√∫t):</label>
                <div class="threshold-inputs">
                    <div class="input-item">
                        <span>Online n·∫øu d∆∞·ªõi:</span>
                        <input type="number" id="time-online-limit" class="custom-input" placeholder="V√≠ d·ª•: 5" onchange="updateTimeConfig('online', this.value)">
                    </div>
                    <div class="input-item">
                        <span>Ngo·∫°i tuy·∫øn n·∫øu d∆∞·ªõi:</span>
                        <input type="number" id="time-offline-limit" class="custom-input" placeholder="V√≠ d·ª•: 60" onchange="updateTimeConfig('offline', this.value)">
                    </div>
                </div>
                <small>N·∫øu v∆∞·ª£t qu√° ng∆∞·ª°ng "Ngo·∫°i tuy·∫øn", h·ªá th·ªëng s·∫Ω b√°o "M·∫•t k·∫øt n·ªëi".</small>
            </div>
        </div>
        <div id="help" class="tab-content">
            <h1>‚ùì H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng H·ªá th·ªëng</h1>
            
            <div class="report-box" style="background: white; padding: 25px; border-radius: 15px; line-height: 1.6;">
                <h3>1. Theo d√µi Realtime (Dashboard)</h3>
                <p>‚Ä¢ C√°c √¥ m√†u ph√≠a tr√™n hi·ªÉn th·ªã gi√° tr·ªã m·ªõi nh·∫•t t·ª´ c√°c tr·∫°m (Node).<br>
                   ‚Ä¢ Tr·∫°ng th√°i <b>Online/Offline</b> d·ª±a tr√™n th·ªùi gian c·∫≠p nh·∫≠t cu·ªëi c√πng so v·ªõi c·∫•u h√¨nh trong m·ª•c C√†i ƒë·∫∑t.</p>
                <h3></h3>
                <h3>2. Xem Bi·ªÉu ƒë·ªì th·ªëng k√™</h3>
                <p>‚Ä¢ V√†o tab <b>Bi·ªÉu ƒë·ªì & Th·ªëng k√™</b> ƒë·ªÉ xem xu h∆∞·ªõng bi·∫øn ƒë·ªông trong 30 ng√†y.<br>
                   ‚Ä¢ B·∫°n c√≥ th·ªÉ ch·ªçn lo·∫°i c·∫£m bi·∫øn (Nhi·ªát ƒë·ªô, Gas...) ƒë·ªÉ thay ƒë·ªïi n·ªôi dung t·∫•t c·∫£ bi·ªÉu ƒë·ªì c√πng l√∫c.</p>
                   <h3></h3>
                <h3>3. Truy v·∫•n & Xu·∫•t d·ªØ li·ªáu</h3>
                <p>‚Ä¢ V√†o tab <b>D·ªØ li·ªáu</b>, ch·ªçn kho·∫£ng th·ªùi gian c·∫ßn tra c·ª©u v√† nh·∫•n <b>Truy v·∫•n</b>.<br>
                   ‚Ä¢ Sau khi d·ªØ li·ªáu hi·ªán ra, nh·∫•n n√∫t <b style="color: #1D6F42;">Xu·∫•t Excel</b> ƒë·ªÉ t·∫£i file v·ªÅ m√°y t√≠nh.</p>
                <h3></h3>
                <h3>4. C·∫•u h√¨nh ng∆∞·ª°ng c·∫£nh b√°o</h3>
                <p>‚Ä¢ T·∫°i tab <b>C√†i ƒë·∫∑t</b>, b·∫°n c√≥ th·ªÉ ch·ªânh ng∆∞·ª°ng an to√†n cho Nhi·ªát ƒë·ªô, PM2.5...<br>
                   ‚Ä¢ Khi gi√° tr·ªã v∆∞·ª£t ng∆∞·ª°ng, h·ªá th·ªëng s·∫Ω t·ª± ƒë·ªông ƒë·ªïi m√†u hi·ªÉn th·ªã ho·∫∑c ph√°t c·∫£nh b√°o.</p>
        
                <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #eee; color: #666;">
                    <p><i class="fas fa-info-circle"></i> <b>L∆∞u √Ω:</b> N·∫øu d·ªØ li·ªáu kh√¥ng c·∫≠p nh·∫≠t, h√£y ki·ªÉm tra k·∫øt n·ªëi Wi-Fi c·ªßa c√°c thi·∫øt b·ªã Node.</p>
                </div>
            </div>
        </div>
    </div> <div class="fixed-tools">
        <div id="data-status" class="status-bar">
            üü° ƒêang k·∫øt n·ªëi server...
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
    <script src="script.js"></script>

</body>
</html>